var fn_addin=function(r,d,t){var s=s||{};return s.styles=s.styles||{},s.commands=s.commands||{},s.dependencies=t||s.dependencies||{},s.styles.style=function(){},s.views=s.views||{},s.collect=s.collect||{},s.models=s.models||{},s.templates=s.templates||{},s.info={id:"links_common",class:"links",appClass:"links-app",region:"top-left",order:"prepend",width:220,addin:"417829ca-7ff0-4089-b265-f775180c843e",toggleEvent:"globalEvent:key:L",closeOnEsc:"true",visibleSetting:"linksVisible"},r.console.log(r.elapsed()+": "+s.info.id+" started"),s.templates=s.templates||{},s.templates["add-group"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,n){var s,l;return'<div class="subview links-add">\n\t<header class="header">\n\t\t<span class="control icon-wrapper back"><i class="icon icon-left"></i></span>\n\n\t\t<div class="edit-mode controls">\n\t\t\t<div class="control more">\n\t\t\t\t<div class="icon-wrapper more-toggle">\n\t\t\t\t\t'+(null!=(s="function"==typeof(l=null!=(l=e.iconEllipsis||(null!=t?t.iconEllipsis:t))?l:e.helperMissing)?l.call(t,{name:"iconEllipsis",hash:{},data:n}):l)?s:"")+'</div>\n\n\t\t\t\t<div class="dropdown more-dropdown">\n\t\t\t\t\t<ul class="dropdown-list">\n\t\t\t\t\t\t<li class="delete">Delete</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</header>\n\n\t<div class="body">\n\t\t<div class="input-group">\n\t\t\t<label>Name</label>\n\t\t\t<input type="text" id="new-title" class="new-title new-group-title" autocomplete="off">\n\t\t</div>\n\t\t<div class="link-urls-wrapper">\n\t\t\t<div class="link-urls">\n\t\t\t\t<label>Links</label>\n\t\t\t\t<ol class="urls"></ol>\n\n\t\t\t\t<input type="text" id="new-url" class="new-url new-group-url" placeholder="example.com" autocomplete="off">\n\n\t\t\t\t<div class="button button-small button-clear add-tab">\n\t\t\t\t\t<svg class="icon icon-plus" viewBox="0 0 448 448" xmlns="http://www.w3.org/2000/svg"><path d="m408 184h-136c-4.417969 0-8-3.582031-8-8v-136c0-22.089844-17.910156-40-40-40s-40 17.910156-40 40v136c0 4.417969-3.582031 8-8 8h-136c-22.089844 0-40 17.910156-40 40s17.910156 40 40 40h136c4.417969 0 8 3.582031 8 8v136c0 22.089844 17.910156 40 40 40s40-17.910156 40-40v-136c0-4.417969 3.582031-8 8-8h136c22.089844 0 40-17.910156 40-40s-17.910156-40-40-40zm0 0"/></svg>\n\t\t\t\t\tAdd Another Tab\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div>\n\t\t\t<span class="button create" data-test="link-save">Create</span>\n\t\t\t<span class="button update" data-test="link-update">Save</span>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),s.templates["quicklinks-item-template"]=Handlebars.template({1:function(t,e,i,n){return" has-dash-icon"},3:function(t,e,i,n){return" has-more"},5:function(t,e,i,n){return' class="local"'},7:function(t,e,i,n){var s;return null!=(s=e.if.call(t,null!=t?t.hasUrls:t,{name:"if",hash:{},fn:this.program(8,n,0),inverse:this.program(10,n,0),data:n}))?s:""},8:function(t,e,i,n){var s;return'\t\t\t\t<span class="icon-folder-label">'+this.escapeExpression("function"==typeof(s=null!=(s=e.iconLabel||(null!=t?t.iconLabel:t))?s:e.helperMissing)?s.call(t,{name:"iconLabel",hash:{},data:n}):s)+'</span><svg class="icon-svg icon-folder" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 27 23"><g fill="none" fill-rule="evenodd"><path id="icon-folder-single" d="M22 20H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h6.5a2 2 0 0 1 1.787 1.1l.81 1.62a.5.5 0 0 0 .448.28H22a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2zM8.191 2H2.5a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h19a.5.5 0 0 0 .5-.5v-12a.5.5 0 0 0-.5-.5H11.236a2 2 0 0 1-1.788-1.1l-.81-1.619A.5.5 0 0 0 8.191 2z"; fill-rule="nonzero"/><path id="icon-folder-multiple" d="M26.24 9.2v11.591c0 .63-.512 1.143-1.142 1.143H9.3" stroke-linecap="round" stroke-linejoin="round"/></g></svg>\n'},10:function(t,e,i,n){var s;return null!=(s=e.if.call(t,null!=t?t.favicon_url:t,{name:"if",hash:{},fn:this.program(11,n,0),inverse:this.program(13,n,0),data:n}))?s:""},11:function(t,e,i,n){var s;return'\t\t\t\t\t<img class="icon-favicon" src="'+this.escapeExpression("function"==typeof(s=null!=(s=e.favicon_url||(null!=t?t.favicon_url:t))?s:e.helperMissing)?s.call(t,{name:"favicon_url",hash:{},data:n}):s)+'">\n'},13:function(t,e,i,n){return'\t\t\t\t\t<span class="link-icon-placeholder">&nbsp;</span>\n'},15:function(t,e,i,n){var s;return null!=(s=e.if.call(t,null!=t?t.noMenu:t,{name:"if",hash:{},fn:this.program(16,n,0),inverse:this.program(21,n,0),data:n}))?s:""},16:function(t,e,i,n){var s;return'\t\t\t<div class="icon-wrapper '+(null!=(s=e.if.call(t,null!=t?t.editing:t,{name:"if",hash:{},fn:this.program(17,n,0),inverse:this.program(19,n,0),data:n}))?s:"")+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212.982 212.982" class="icon icon-hide"><path d="M131.804 106.491l75.936-75.936c6.99-6.99 6.99-18.323 0-25.312-6.99-6.99-18.322-6.99-25.312 0L106.491 81.18 30.554 5.242c-6.99-6.99-18.322-6.99-25.312 0-6.989 6.99-6.989 18.323 0 25.312l75.937 75.936-75.937 75.937c-6.989 6.99-6.989 18.323 0 25.312 6.99 6.99 18.322 6.99 25.312 0l75.937-75.937 75.937 75.937c6.989 6.99 18.322 6.99 25.312 0 6.99-6.99 6.99-18.322 0-25.312l-75.936-75.936z"/></svg></div>\n'},17:function(t,e,i,n){return"draft-destroy"},19:function(t,e,i,n){return"destroy"},21:function(t,e,i,n){var s;return'\t\t\t<div class="more'+(null!=(s=e.if.call(t,null!=t?t.pinned:t,{name:"if",hash:{},fn:this.program(22,n,0),inverse:this.noop,data:n}))?s:"")+'">\n\t\t\t\t<div class="icon-wrapper more-toggle'+(null!=(s=e.if.call(t,null!=t?t.pinned:t,{name:"if",hash:{},fn:this.program(24,n,0),inverse:this.noop,data:n}))?s:"")+'">\n\t\t\t\t\t'+(null!=(s=(e.iconEllipsis||t&&t.iconEllipsis||e.helperMissing).call(t,null!=t?t.ellipsisIconClass:t,{name:"iconEllipsis",hash:{},data:n}))?s:"")+'\n\t\t\t\t</div>\n\t\t\t\t<div class="dropdown more-dropdown">\n\t\t\t\t\t<ul class="dropdown-list">\n'+(null!=(s=e.if.call(t,null!=t?t.showPinOption:t,{name:"if",hash:{},fn:this.program(26,n,0),inverse:this.noop,data:n}))?s:"")+(null!=(s=e.if.call(t,null!=t?t.isGroup:t,{name:"if",hash:{},fn:this.program(28,n,0),inverse:this.noop,data:n}))?s:"")+'\t\t\t\t\t\t<li class="destroy">\n\t\t\t\t\t\t\t<span class="item-label">Delete</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n'},22:function(t,e,i,n){return" more-dash"},24:function(t,e,i,n){return" dash-icon-wrapper"},26:function(t,e,i,n){var s;return'\t\t\t\t\t\t<li class="link-pin toggleable '+this.escapeExpression("function"==typeof(s=null!=(s=e.pinnedClass||(null!=t?t.pinnedClass:t))?s:e.helperMissing)?s.call(t,{name:"pinnedClass",hash:{},data:n}):s)+'">\n\t\t\t\t\t\t\t<span class="item-label pin">Pin</span>\n\t\t\t\t\t\t\t<span class="item-label unpin">Unpin</span>\n\t\t\t\t\t\t</li>\n'},28:function(t,e,i,n){return'\t\t\t\t\t\t<li class="detail">\n\t\t\t\t\t\t\t<span class="item-label">Modify</span>\n\t\t\t\t\t\t</li>\n'},30:function(t,e,i,n){var s;return null!=(s=e.if.call(t,null!=t?t.readOnly:t,{name:"if",hash:{},fn:this.program(31,n,0),inverse:this.noop,data:n}))?s:""},31:function(t,e,i,n){return'\t\t\t<div class="more has-read-only">\n\t\t\t\t<div class="icon-wrapper">\n\t\t\t\t\t<svg class="icon icon-lock read-only" title="Admin Locked" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 328.9 402"><path d="M357.45,190.72a26.43,26.43,0,0,0-19.42-8H328.9V127.91q0-52.54-37.68-90.22T201,0q-52.55,0-90.22,37.69T73.09,127.91v54.82H64a27.28,27.28,0,0,0-27.41,27.41V374.59A27.28,27.28,0,0,0,64,402H338a27.28,27.28,0,0,0,27.41-27.41V210.13A26.43,26.43,0,0,0,357.45,190.72Zm-83.36-8H127.91V127.91q0-30.27,21.41-51.68T201,54.82q30.27,0,51.68,21.41t21.41,51.68Z" transform="translate(-36.55)"/></svg>\n\t\t\t\t</div>\n\t\t\t</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,n){var s,l,a=e.helperMissing,o="function",r=this.escapeExpression;return'\x3c!-- This template is used for both new and legacy links If things are refactored, for testing try manually setting the noMenu property to true--\x3e\n<div draggable="'+r(typeof(l=null!=(l=e.draggable||(null!=t?t.draggable:t))?l:a)==o?l.call(t,{name:"draggable",hash:{},data:n}):l)+'" class="link-wrapper '+r(typeof(l=null!=(l=e.classes||(null!=t?t.classes:t))?l:a)==o?l.call(t,{name:"classes",hash:{},data:n}):l)+(null!=(s=e.if.call(t,null!=t?t.pinned:t,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+(null!=(s=e.unless.call(t,null!=t?t.noMenu:t,{name:"unless",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?s:"")+'">\n\t<a draggable="false" href="'+r(typeof(l=null!=(l=e.url||(null!=t?t.url:t))?l:a)==o?l.call(t,{name:"url",hash:{},data:n}):l)+'"'+(null!=(s=e.if.call(t,null!=t?t.local:t,{name:"if",hash:{},fn:this.program(5,n,0),inverse:this.noop,data:n}))?s:"")+">\n"+(null!=(s=e.unless.call(t,null!=t?t.noIcon:t,{name:"unless",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n}))?s:"")+'\t\t<span class="link-text">'+r(typeof(l=null!=(l=e.title||(null!=t?t.title:t))?l:a)==o?l.call(t,{name:"title",hash:{},data:n}):l)+"</span>\n\t</a>\n\n"+(null!=(s=e.unless.call(t,null!=t?t.readOnly:t,{name:"unless",hash:{},fn:this.program(15,n,0),inverse:this.noop,data:n}))?s:"")+"\n"+(null!=(s=e.unless.call(t,null!=t?t.pinned:t,{name:"unless",hash:{},fn:this.program(30,n,0),inverse:this.noop,data:n}))?s:"")+"</div>\n"},useData:!0}),s.templates.quicklinks=Handlebars.template({1:function(t,e,i,n){var s,l,a,o=e.helperMissing,r="function",d='\t\t\t\t\t\t<li data-momo-id="chromeTab" data-place="links" class="optional-link"><a\n\t\t\t\t\t\t\thref="chrome-search://local-ntp/local-ntp.html" class="local">\n\t\t\t\t\t\t\t'+(null!=(s=(e.browserIcon||t&&t.browserIcon||o).call(t,"icon-favicon icon-svg",{name:"browserIcon",hash:{},data:n}))?s:"")+"\n\t\t\t\t\t\t\t"+this.escapeExpression(typeof(l=null!=(l=e.browserName||(null!=t?t.browserName:t))?l:o)==r?l.call(t,{name:"browserName",hash:{},data:n}):l)+" Tab</a></li>\n";return l=null!=(l=e.isChrome||(null!=t?t.isChrome:t))?l:o,a={name:"isChrome",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},s=typeof l==r?l.call(t,a):l,e.isChrome||(s=e.blockHelperMissing.call(t,s,a)),null!=s&&(d+=s),d},2:function(t,e,i,n){return'\t\t\t\t\t\t\t<li data-momo-id="apps" class="optional-link" data-place="links"><a href="chrome://apps" id="app-return" class="local">\n\t\t\t\t\t\t\t\t<svg class="icon-favicon icon-svg icon-apps" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M3 3h6v6H3V3zm10 0h6v6h-6V3zm10 0h6v6h-6V3zM3 13h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6zM3 23h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6z"/></svg>\n\t\t\t\t\t\t\t\tApps</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,n){var s,l,a,o=e.helperMissing,r="function",d='<div class="subviews-wrapper">\n\t<div class="subviews first no-transition">\x3c!--\n\n\n\t--\x3e<div class="subview links-main">\n\t\t\t\x3c!-- <header class="header">\n\t\t\t\t<span class="title">Links</span>\n\t\t\t\t<div class="controls">\n\t\t\t\t</div>\n\t\t\t</header> --\x3e\n\t\t\t<div class="body">\n\n\t\t\t\t<div class="loading-message message"><i class="loading-icon"></i><span class="loading-label">Loading...</span></div>\n\t\t\t\t<ol class="links-list" style="max-height: '+this.escapeExpression(typeof(l=null!=(l=e.maxHeight||(null!=t?t.maxHeight:t))?l:o)==r?l.call(t,{name:"maxHeight",hash:{},data:n}):l)+'px">\n';return l=null!=(l=e.isChromium||(null!=t?t.isChromium:t))?l:o,a={name:"isChromium",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},s=typeof l==r?l.call(t,a):l,e.isChromium||(s=e.blockHelperMissing.call(t,s,a)),null!=s&&(d+=s),d+'\t\t\t\t</ol>\n\n\t\t\t\t<div class="empty">\n\t\t\t\t\t<div class="title">No links yet</div>\n\t\t\t\t\t<div class="description">Add your favorite links</div>\n\t\t\t\t\t<span class="button new-toggle empty-toggle">New Link</span>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="footer-input">\n\t\t\t\t\t<span class="new-toggle"><span class="icon icon-favicon icon-plus"></span> New Link</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\x3c!--\n\n\n\t\t--\x3e'+(null!=(s=this.invokePartial(e.lookup.call(t,t,"addGroup",{name:"lookup",hash:{},data:n}),t,{data:n,helpers:e,partials:i}))?s:"")+"\n\n\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),s.templates.teamlinks=Handlebars.template({1:function(t,e,i,n){var s,l,a,o=e.helperMissing,r="function",d='\t\t\t\t\t\t\t\t<li data-momo-id="chromeTab" data-place="links" class="optional-link"><a\n\t\t\t\t\t\t\t\t\t\thref="chrome-search://local-ntp/local-ntp.html" class="local">\n\t\t\t\t\t\t\t\t\t'+(null!=(s=(e.browserIcon||t&&t.browserIcon||o).call(t,"icon-favicon icon-svg",{name:"browserIcon",hash:{},data:n}))?s:"")+"\n\t\t\t\t\t\t\t\t\t"+this.escapeExpression(typeof(l=null!=(l=e.browserName||(null!=t?t.browserName:t))?l:o)==r?l.call(t,{name:"browserName",hash:{},data:n}):l)+" Tab</a></li>\n";return l=null!=(l=e.isChrome||(null!=t?t.isChrome:t))?l:o,a={name:"isChrome",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},s=typeof l==r?l.call(t,a):l,e.isChrome||(s=e.blockHelperMissing.call(t,s,a)),null!=s&&(d+=s),d},2:function(t,e,i,n){return'\t\t\t\t\t\t\t\t\t<li data-momo-id="apps" class="optional-link" data-place="links"><a href="chrome://apps" id="app-return" class="local">\n\t\t\t\t\t\t\t\t\t\t<svg class="icon-favicon icon-svg icon-apps" xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\t\t\t\t\t\t viewBox="0 0 32 32">\n\t\t\t\t\t\t\t\t\t\t\t<path d="M3 3h6v6H3V3zm10 0h6v6h-6V3zm10 0h6v6h-6V3zM3 13h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6zM3 23h6v6H3v-6zm10 0h6v6h-6v-6zm10 0h6v6h-6v-6z"></path>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\tApps</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,n){var s,l,a,o=e.helperMissing,r="function",d=this.escapeExpression,p='<div class="app-dash">\n\t<div class="team-dash-links-wrapper" data-ob="links-dash">\n\t\t<ol class="team-dash-links add-shadow"></ol>\n\t\t<span class="more-links-wrapper">\n\t\t\t<span class="more-links">'+d(typeof(l=null!=(l=e.moreDropdownText||(null!=t?t.moreDropdownText:t))?l:o)==r?l.call(t,{name:"moreDropdownText",hash:{},data:n}):l)+'</span>\n\t\t\t<i class="icon icon-angle-down"></i>\n\t\t</span>\n\t</div>\n</div>\n\n<div class="app-wrapper nipple nipple-top-left">\n\t<div class="app links-app">\n\t\t<div class="subviews-wrapper">\n\t\t\t<div class="subviews no-transition">\x3c!--\n\t\t\t--\x3e<div class="subview links-main">\n\t\t\t\t\t<div class="body">\n\t\t\t\t\t\t<ol class="more-links-list links-list" style="max-height: '+d(typeof(l=null!=(l=e.maxHeight||(null!=t?t.maxHeight:t))?l:o)==r?l.call(t,{name:"maxHeight",hash:{},data:n}):l)+'px">\n';return l=null!=(l=e.isChromium||(null!=t?t.isChromium:t))?l:o,a={name:"isChromium",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},s=typeof l==r?l.call(t,a):l,e.isChromium||(s=e.blockHelperMissing.call(t,s,a)),null!=s&&(p+=s),p+'\t\t\t\t\t\t</ol>\n\t\t\t\t\t\t<div class="add-error-message message">Connection required to add link. <span\n\t\t\t\t\t\t\t\tclass="message-action retry-add">Retry</span></div>\n\t\t\t\t\t\t<div class="message-empty"><i class="loading-icon"></i>Loading...</div>\n\t\t\t\t\t\t<div class="empty">\n\t\t\t\t\t\t\t<div class="title">No links yet</div>\n\t\t\t\t\t\t\t<div class="description">Add your favorite links</div>\n\t\t\t\t\t\t\t<span class="button new-toggle empty-toggle">New Link</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="footer-input">\n\t\t\t\t\t\t\t<span class="new-toggle"><span class="icon icon-favicon icon-plus"></span> New Link</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\x3c!--\n\n\t\t\t--\x3e'+(null!=(s=this.invokePartial(e.lookup.call(t,t,"addGroup",{name:"lookup",hash:{},data:n}),t,{data:n,helpers:e,partials:i}))?s:"")+"\n\n\t\t\t</div>\x3c!--\n\t --\x3e</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),s.styles=s.styles||{},s.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML=".links{--app-width:250px;--link-v-padding:5px}.links.wide{--app-width:310px}.links.wider{--app-width:360px}.links.widest{--app-width:410px}.links-wrapper{position:absolute;top:100%;left:7px;display:none}.links-app{width:var(--app-width);min-width:200px;padding:0;overflow-y:hidden;transition-property:opacity,height}.links .subview,.links .subviews.no-transition{transition:none}.links .links-list{display:none;overflow-y:auto}.links.is-empty .links-list{display:none}.links .links-list .optional-link.show{display:flex}.links input:hover{opacity:1}.links li{position:relative}.links li .link-wrapper{display:flex;justify-content:space-between}.links li a{min-width:125px;max-width:calc(var(--app-width) - 67px);padding:var(--link-v-padding) calc(var(--app-padding) - 3px);display:inline-block;flex:1 1 auto;cursor:pointer;font-size:1rem;line-height:100%;opacity:.75;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.links .app li:first-child .icon-wrapper,.links .app li:first-child a,.links .first-link .link-wrapper .icon-wrapper,.links .first-link a{padding-top:calc(var(--app-padding) - 1px)}.links li a:hover{opacity:1}.links li .icon-wrapper{padding-right:calc(var(--app-padding) - 2px);opacity:0}.links li:hover .icon-wrapper{opacity:1}.links li .icon-wrapper.draft-destroy{padding-right:5px}.links li.placeholder a{display:inherit}.light .app .links li a{opacity:.8}.links .icon-chrome-tab{height:15px;width:15px;margin-right:3px}.links .icon-folder-label{width:16px;padding-right:4px;position:absolute;z-index:2;box-sizing:border-box;font-size:8px;font-weight:700;line-height:17px;text-align:center;text-transform:uppercase}.links .icon-folder.icon-svg #icon-folder-single{fill:var(--icon-color)}.links .team-dash-links .icon-folder.icon-svg #icon-folder-single,.team-dash-links .icon-hide{fill:#fff}.links .icon-folder.icon-svg #icon-folder-multiple{stroke:var(--icon-color)}.links .team-dash-links .icon-folder.icon-svg #icon-folder-multiple{stroke:#fff}.links.show-message .first-link a{margin-top:-20px}.links .first-link .destroy{top:auto;bottom:2px}.links .more{display:flex;align-items:center}.links li.opening .dropdown-wrapper{opacity:0}.links .more-toggle{padding:4px}.links .icon-wrapper:after{--icon-wrapper-size:23px}.links .more-dropdown{margin-top:-7px;right:calc(var(--app-padding) - 6px)}.links li.active .more-dropdown{display:block}.links .has-read-only{pointer-events:none}.links .has-read-only .icon-lock{margin-top:-1px;margin-right:1px}.links .footer-input{display:none;flex-shrink:0}.links .footer-input .new-toggle{padding:4px calc(var(--app-padding) - 3px) calc(var(--app-padding) - 3px);display:block;color:var(--app-text-color);opacity:.4;cursor:pointer;font-size:1rem;font-weight:400;line-height:normal}.links .footer-input .new-toggle:hover{opacity:.8}.links .footer-input .new-toggle .icon{opacity:1;margin:0 3px 0 0}.links .new-group-url{display:none}.links .new-group-url.active{display:block}.links .button-small .icon{opacity:1}.links .new-group-toggle{margin-left:var(--app-padding);margin-bottom:calc(var(--app-padding) - 2px);display:none}.links .open .new-group-toggle{display:inline-block}.links .body>.empty{height:195px;padding-top:29px}.links .message{margin:15px 0;display:none}.links.show-message .message{display:block}.links.show-message .empty{margin-top:-25px}.links .header{flex-shrink:0}.links .header .icon-wrapper{opacity:inherit}.links .header .filler{width:20px}.links .link-pin.active .pin,.links .unpin{display:none}.links .link-pin.active .unpin{display:inline-block}.links .upsell .hide .icon{opacity:.6}.links .subviews{width:calc(var(--app-width) * 4)}.links .subview{width:var(--app-width);display:flex;flex-direction:column}.links .links-main .body{padding:0;position:relative;display:flex;flex-direction:column;overflow-y:auto}.links-add .update,.links-add .urls .link-icon-placeholder,.links-add .urls img,.links-add .urls:empty,.links-add.editing .create{display:none}.links-add input{padding-left:0;padding-right:0}.links-add input::placeholder{opacity:.4}.links-add .body{max-height:calc(100% - var(--header-height) - var(--app-padding));padding:0 var(--app-padding) var(--app-padding);box-sizing:border-box;overflow-y:auto}.links-add .link-urls-wrapper{transition:height .3s ease}.links.disable-smooth-height .links-add .link-urls-wrapper{height:auto!important}.links-add .urls{margin:6px 0 2px;padding:4px 0;border:1px solid var(--border-color-low);border-width:1px 0}.links-add .urls li a{padding:4px 0!important;opacity:1;box-sizing:border-box}.links-add .urls li:first-child a{padding-top:2px}.app .links-add li:first-child .icon-wrapper{padding:5px}.links-add .urls .destroy{margin-right:-5px;padding-right:5px;font-size:11px;line-height:12px;opacity:1}.links-add .add-tab{margin-top:2px;margin-left:-2px}.links-add .edit-mode{visibility:hidden}.links-add.editing .edit-mode{visibility:visible}.links-add.editing .add-mode{visibility:hidden}.links-add.editing .update{display:inline-block}.teamlinks{padding-left:0}.links-add .button.create,.links-add .button.update{margin-top:18px}.teamlinks .more-links-list{overflow:auto}.team-dash-links-wrapper{--more-links-vert-padding:7px;--dashlink-left-padding:20px;--first-link-top-padding:9px;position:absolute;top:100%;left:0;z-index:1}.has-logo-placeholder .team-dash-links-wrapper,.has-no-logo .team-dash-links-wrapper{top:calc(100% - var(--more-links-vert-padding))}.has-no-logo:not(.dashlinks-visible):not(.search-visible) .team-dash-links-wrapper{top:0}.team-dash-links li .link-wrapper{justify-content:initial}.team-dash-links li a{min-width:0;padding:var(--link-v-padding) calc(var(--app-padding) - 10px) var(--link-v-padding) var(--dashlink-left-padding);flex-grow:0;color:#fff;font-size:.9375rem;font-weight:400;opacity:.85}.show .team-dash-links li:hover .icon-wrapper,.team-dash-links li a:hover{opacity:1}.team-dash-links .icon-wrapper:hover:after{background:rgba(255,255,255,.12)}.team-dash-links .more-dropdown{margin-top:8px;left:3px;right:auto;color:var(--app-text-color)}.team-dash-links .dropdown-wrapper .icon-wrapper{padding-top:0;padding-bottom:0}.teamlinks .more-links-wrapper{display:flex;align-items:center;justify-content:flex-start;opacity:0;cursor:pointer;transition:opacity ease;transition-duration:.1s}.team-dropdown-open .teamlinks:hover .more-links-wrapper{display:none}.teamlinks:hover .more-links-wrapper{opacity:.6}.teamlinks .more-links-wrapper:hover{opacity:.8}.teamlinks.show-fade-in .more-links-wrapper{opacity:.9}.teamlinks .more-links-wrapper .more-links{padding:var(--more-links-vert-padding) 2px var(--more-links-vert-padding) var(--dash-side-margin);display:block;font-size:.75rem;font-weight:500;line-height:100%;text-transform:uppercase}.teamlinks .more-links-wrapper .icon-angle-down{margin-top:-3px;display:none;font-size:.875rem;line-height:1}.teamlinks .app-wrapper{position:absolute;transition-property:opacity,height,transform;z-index:5}.teamlinks .links-main li:first-child .icon-wrapper,.teamlinks .links-main li:first-child a{padding-top:calc(var(--app-padding) - 3px)}.team-dash-links li a img{display:none}",document.getElementsByTagName("head")[0].appendChild(t)},s.models.QuickLink=Backbone.Model.extend({idAttribute:"csid",defaults:function(){return{url:"",local:!1,order:0,type:0,deleted:!1,draft:!1}},initialize:function(t){t=t||{},this.idAttribute=this.collection&&this.collection.idAttribute||"csid",this.serverIdAttribute=this.collection&&this.collection.serverIdAttribute||"id",Backbone.Model.prototype.initialize.call(this,t)},saveHandler:function(e){if(this.sublinks)this.sublinks.map(function(t){t.save({parentLinkId:e.id,unsyncable:!1})});else{var t=this.collection.findWhere({id:this.get("parentLinkId")});if(t){var i=t.get("linksOrder").slice(0),n=i.indexOf(this.get("csid"));0<=n&&(i.splice(n,1,e.id),t.save({linksOrder:i}))}}},mainContent:function(){var t={};return t.title=this.get("title"),t.url=this.get("url"),t},getFriendlyUrl:function(){var t=this.get("url");return t.substr(Math.max(t.indexOf("://")+3,0))},saveOptions:function(){return this.collection&&this.collection.saveOptions},getActiveSublinks:function(){var e=[];return this.sublinks&&this.sublinks.map(function(t){t.get("deleted")||e.push(t)}),e},delete:function(){this.group&&this.group.removeChild(this),this.save("deleted",!0)},removeChild:function(t){this.sublinks.splice(this.sublinks.indexOf(t),1)},isTeamLink:function(){var t=this.get("id");return t&&"T"===t[0]},comparator:"order"}),s.collect.QuickLinks=r.collect.SyncedCollection.extend({initialize:function(t,e){e=e||{},this.LinkTypes=s.LinkTypes,e.name=e.name||"quicklinks",e.model=e.model||s.models.QuickLink,e.localProps=["unsyncable","order"],e.transientProps=["draftDeleted"],e.apiUrl=r.globals.urlRoot+"links",r.collect.SyncedCollection.prototype.initialize.call(this,t,e),this.listenTo(this,"reorder",this.reorderItem),this.listenTo(this,"reset",this.removeDrafts)},saveOptions:{patch:!0},comparator:"order",removeDrafts:function(){this.resetOnce||(this.resetOnce=!0,this.models.map(function(t){t.get("draft")&&t.destroy({silent:!0})}))},reorderItem:function(t){var e,i,n=this.findWhere({id:t.moveId})||this.findWhere({csid:t.moveId}),s=this.findWhere({id:t.moveTargetId})||this.findWhere({csid:t.moveTargetId});if(n&&s){var l=(e=(i=n.get("parentLinkId"))?this.findWhere({id:i})||this.findWhere({csid:i}):this.getRootLink()).get("linksOrder").slice(0),a=Math.max(l.indexOf(n.get("id")),l.indexOf(n.get("csid")));l.splice(a,1);var o=Math.max(l.indexOf(s.get("id")),l.indexOf(s.get("csid")));l.splice(o+t.moveOffset,0,t.moveId),e.save({linksOrder:l})}},confirmCreate:function(t){t.save("draft",!1),t.sublinks.map(function(t){t.get("draft")&&!t.get("deleted")&&t.save({draft:!1},{silent:!0})});var e=this.getRootLink(),i=e.get("linksOrder").slice(0);i.push(t.get("id")||t.get("csid")),e.save({linksOrder:i})},getHierarchy:function(){var s,e=[],i=this;this.where({type:this.LinkTypes.GROUP,deleted:!1}).map(function(t){t.get("isRoot")||(t.sublinks=i.where({deleted:!1,parentLinkId:t.get("id")||t.get("csid")}),s=t.get("linksOrder")||[],t.sublinks.map(function(t){t.set({order:Math.max(s.indexOf(t.get("id")),s.indexOf(t.get("csid")),0)})}),t.sublinks.sort(a),e.push(t))}),e=e.concat(this.where({type:this.LinkTypes.LINK,deleted:!1}));var t=this.findWhere({isRoot:!0}),n=this.findWhere({isTeamRoot:!0});return l(t,1e3,function(t){return!t.isTeamLink()}),l(n,0,function(t){return t.isTeamLink()}),e.sort(a),e;function l(t,i,n){t&&(s=t.get("linksOrder")||[],e.map(function(t){if(!n||n(t)){var e=s.indexOf(t.get("id"));e<0&&(e=s.indexOf(t.get("csid"))),e<0&&t.get("id")&&(s.push(t.get("id")),e=s.length-1),t.set({order:i+e})}}))}function a(t,e){return t.get("order")+(t.get("pinned")?0:1e5)-(e.get("order")+(e.get("pinned")?0:1e5))}},getRootLink:function(){var e=this.findWhere({isRoot:!0});!e&&this.offlineOnly&&(e={isRoot:!0,linksOrder:[],type:this.LinkTypes.GROUP},this.getHierarchy().map(function(t){e.linksOrder.push(t.get("id")||t.get("csid"))}),this.create(e),e=this.findWhere({isRoot:!0}));return e},handleOrdering:function(t){var i=[],n=this.serverIdAttribute;t.map(function(t){t.root&&(i=t.linksOrder)}),this.models.map(function(t){var e=i.indexOf(t.get(n));0<=e&&t.save({order:e},{ignoreRender:!0,silent:!0})})}}),s.views.QuickLink=Backbone.View.extend({tagName:"li",template:s.templates["quicklinks-item-template"],events:{"keypress .todo-input":"updateOnEnter","click .destroy":"delete","click .draft-destroy":"draftDelete",dragstart:"dragstart",dragenter:"dragenter","click a":"handleClick","click .more":"toggleDropdown","click .detail":"showDetail","click .link-pin":"togglePin"},initialize:function(t){this.dropdownOpen=!1,_.bindAll(this,"dragstart","dragenter"),this.parent=t.parent,this.noIcon=t.noIcon,this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"change:archive destroy",this.remove),this.listenTo(r,"globalEvent:click globalEvent:esc globalEvent:closeDropdowns",this.hideDropdown)},onChange:function(){this.model.get("deleted")?this.destroy():this.render()},render:function(){var i=this,t=this.model.sublinks,n=this.model.get("url")||t&&1===t.length&&t[0].get("url");this.moreIsSet=!1;var s=getFavIcon(n);if(this.noIcon)this.loadLink(!1);else{var l=new Image;this.loadLink(!1),r.utils.isChromiumExtension()&&r.utils.isChrome()?getBrowser().permissions.contains(r.models.bookmarksSettings.permissions,function(t){if(t){var e="chrome://favicon/size/16@2x/"+n;d.ajax({url:e}).done(function(t){t===i.parent.notFoundIcon?l.src=s:i.loadLink(e)})}else l.src=s}):l.src=s,l.onload=function(){i.loadLink(s)}}return i},hideDropdown:function(t){this.keepOpen?this.keepOpen=!1:!this.dropdownOpen||t&&d.contains(this.$el[0],t.target)||this.toggleDropdown()},showDetail:function(t){t.stopPropagation(),this.toggleDropdown(),this.parent.showDetail(this.model,t)},toggleDropdown:function(t){t&&t.stopPropagation(),this.dropdownOpen=!this.dropdownOpen,this.dropdownOpen&&(this.keepOpen=!0,r.trigger("globalEvent:closeDropdowns"));var e=t&&d(t.currentTarget).closest("li")||this.$el;e.toggleClass("active",this.dropdownOpen),e.find(".more").toggleClass("active",this.dropdownOpen);var i=this.$el.find(".dropdown");if(0!==i.length){var n=i.closest(".links-list");if(this.dropdownOpen){this.model.get("pinned")&&this.parent.isOpen&&this.parent.forceHidePopup(!0);var s=i[0].getBoundingClientRect().bottom;if(n.height()<i.height()+10&&n.css({height:i.height()+10}),0===n.length&&(n=i.closest(".more-links-list")),0===n.length)return;var l=n[0].getBoundingClientRect().bottom-s-5,a=i.css("margin-top");a=Number.parseFloat(a.substring(0,a.length-2)),this.baseMargin||(this.baseMargin=a);var o=l<0?a+l:a;i.css({"margin-top":o}),8!==o?i.css({right:"calc(100% + 5px)"}):i.css({right:"calc(var(--app-padding)"})}else n.css({height:"auto"}),i.css({"margin-top":this.baseMargin})}},loadLink:function(t){var e=r.utils.captionFormatter(this.model.get("title")||this.model.getFriendlyUrl()),i=this.model.sublinks,n=this.model.get("url")||i&&1===i.length&&i[0].get("url"),s=this.model.get("local"),l=this.model.get("readOnly"),a=!!this.model.get("pinned"),o={title:e,iconLabel:e[0],draggable:!this.model.isTeamLink(),url:n,showPinOption:!!this.parent.team,noMenu:!!this.model.get("parentLinkId")||!this.parent.team&&!this.model.sublinks,noIcon:this.noIcon,hasUrls:this.model.sublinks&&1<this.model.sublinks.length,isGroup:this.model.get("type")===this.parent.LinkTypes.GROUP,local:s,readOnly:l,favicon_url:t,pinned:a,ellipsisIconClass:a?"dash-icon":"",pinnedClass:a?"active":"",team:this.parent.team,editing:this.model.get("type")===this.parent.LinkTypes.SUBLINK&&this.parent.activeModel&&!this.parent.activeModel.get("draft")};this.$el.html(this.template(o)),this.model.isTeamLink()||this.$el.prop("draggable","true")},destroy:function(){this.remove(),this.unbind()},delete:function(t){t.stopPropagation(),this.toggleDropdown(),r.sendEvent("Quick Links","Delete"),this.model.delete()},draftDelete:function(t){t.stopPropagation(),r.sendEvent("Quick Links","Delete"),this.model.set({draftDeleted:!0},{silent:!0}),this.$el.remove();var e=this.parent.$el.find(".new-group-url");this.parent.activeModel.sublinks.length&&!this.parent.activeModel.sublinks.every(function(t){return t.get("draftDeleted")})||e.addClass("active"),e.trigger("focus")},dragstart:function(t){if(r.trigger("globalEvent:closeDropdowns"),this.dropdownOpen&&this.toggleDropdown(),this.model.isTeamLink())return t.originalEvent.dataTransfer.effectAllowed="none",void t.stopPropagation();t.originalEvent.dataTransfer.effectAllowed="move",t.originalEvent.dataTransfer.setData("text","dummy"),this.parent.handleDragStart(this)},dragenter:function(t){if(this.model.isTeamLink())t.stopPropagation();else if("quicklink"===this.parent.dragmode){var e=this.model.collection;this.parent.dragging.$el.hide(),this.parent.$placeholder||this.parent.addPlaceholder();var i=e.serverIdAttribute,n=e.idAttribute,s=e.offlineOnly?n:i,l=this.model.get(s)||this.model.get(n);this.parent.li_index(this.parent.$placeholder)<this.parent.li_index(this.$el)?(this.$el.after(this.parent.$placeholder),this.parent.moveTargetId=l,this.parent.moveOffset=1):(this.$el.before(this.parent.$placeholder),this.parent.moveTargetId=l,this.parent.moveOffset=0);var a=this.parent.$placeholder;this.parent.$placeholder.css("display","list-item"),a.after(this.parent.dragging.$el)}},handleClick:function(t){t.stopPropagation(),t.preventDefault();var e=this,i=this.model.sublinks;if(i){if(1===i.length)return void n(i[0].get("url"),t);e.$el.addClass("opening"),setTimeout(function(){e.$el.removeClass("opening")},1e3),browser=getBrowser(),t.metaKey?browser.windows.create({focused:!0,url:i.map(function(t){return t.get("url")})}):i.map(function(t){t.get("deleted")||browser.tabs.create({url:t.get("url"),active:!1})})}else n(this.model.get("url"),t);function n(t,e){r.models.bookmarksSettings.get("openInNewTab")||e.metaKey?getBrowser().tabs.create({url:t,active:!1}):getBrowser().tabs.update({url:t})}},togglePin:function(t){t.stopPropagation(),this.model.save("pinned",!this.model.get("pinned")),this.toggleDropdown(),this.model.collection.trigger("refresh"),this.parent.setAppPosition()},updateOnEnter:function(t){13===t.keyCode&&this.close(d(t.currentTarget).data("field"))}}),s.views.QuickLinks=Backbone.View.extend({attributes:{id:"quicklinks",class:"app-container"},offline:!0,initialFetchStarted:!1,events:{"click .app-dash.toggle":"toggleShow","click .more-links-wrapper":"toggleHandler","click a":"handleClick","blur .new-group-title":"saveTitle","keyup .new-group-title":"handleNameKeyUp","keyup .new-group-url":"saveUrl","click .add-tab":"saveUrlByClick","click .back":"handleBack","click .new-toggle":"showAddGroup","click .delete":"deleteGroup","click .new-group-toggle":"showAddGroup","click .save-link":"saveLink","click .header .more-toggle":"toggleDropdown","click .create":"confirmCreate","click .update":"confirmUpdate",dragover:"dragover",dragend:"dragend",drop:"drop"},initialize:function(t){this.LinkTypes=s.LinkTypes,this.DropdownTitles={EMPTY_STATE:"Add Link",NO_PINNED:"Links",HAS_PINNED:"More"};var e=this;this.subViews=[],_.bindAll(this,"addOne","addAll","dragover","dragend","li_index"),this.isPlusUser=r.conditionalFeatures.featureEnabled("plus"),this.renderedOnce=!1,this.name=this.options.name,this.linksOpenKey=this.name+"Open",this.team=this.options.team,this.template=this.team?s.templates.teamlinks:s.templates.quicklinks,this.attributes.id=this.options.id,this.isOpen=!this.team,this.$el.addClass(this.options.class),this.listenTo(r,"globalEvent:esc",this.hidePopup),this.listenTo(r,"globalEvent:toggleQuickLinks",this.toggleShow),this.listenTo(this.collection,"remove",this.checkOptionalLinks),this.listenTo(this.collection,"change",this.handleDelete),this.listenTo(this.collection,"add",this.added),this.listenTo(this.collection,"reset refresh",this.collectionReset),this.listenTo(this.collection,"error",this.collectionError),this.listenTo(r.models.customization,"change:linksVisible",this.visibleChanged),this.listenTo(r.models.customization,"change:linksKeepOpen",this.keepOpenChanged),this.listenTo(r.models.bookmarksSettings,"change:appsLocation",this.checkOptionalLinks),this.listenTo(r.models.bookmarksSettings,"change:chromeTabLocation",this.checkOptionalLinks),this.listenTo(r,"globalEvent:window:resize",this.handleResize),this.listenTo(r,"appsReady",this.appsLoaded),this.$el.mClickOutside(this,this.hidePopup),this.render(),this.setHeightLimit(),this.doFetchIfNeeded(),this.notFoundIcon="",r.utils.isChrome()&&void 0!==getBrowser().topSites&&d.ajax({url:"chrome://favicon/size/16@2x/http://notfoundurl.com"}).done(function(t){e.notFoundIcon=t})},initializeResizeSensor:function(){this.resizeSensor&&this.resizeSensor.detach(),this.resizeSensor=new ResizeSensor(this.$linkUrls,function(){this.$linkUrlsWrapper.css("height",this.$linkUrls[0].clientHeight)}.bind(this))},deleteGroup:function(){this.activeModel&&this.activeModel.delete(),this.showMain(),this.toggleDropdown()},handleDelete:function(t){if(t&&this.activeModel&&t.get("parentLinkId")===this.activeModel.id&&(t.changed.deleted||t.get("deleted"))){this.clearUrl();var e=this.$el.find(".new-group-url");e.addClass("active"),e.focus()}t&&t.changed.deleted&&(this.checkOptionalLinks(),this.team&&this.isOpen&&this.setAppPosition())},toggleDropdown:function(t){var e;t?(e=d(t.currentTarget).parent()).toggleClass("active",!this.dropdownOpen):e=this.$el,e.find(".more").toggleClass("active",!this.dropdownOpen),this.dropdownOpen=!this.dropdownOpen},checkOptionalLinks:function(){var i=this;this.$el.find(".optional-link").each(function(t,e){i.checkInclusion(e)}),this.updateFirstLink(),this.toggleEmptyState(this.checkEmpty()),this.team&&this.$app.toggleClass("no-extra",!this.checkLinksInMoreDropdown())},updateFirstLink:function(){this.$el.find("li").removeClass("first-link"),this.$el.find(".optional-link.show").first().addClass("first-link"),0===this.$el.find(".first-link").length&&this.$el.find(".links-app li").not(".optional-link").first().addClass("first-link")},checkEmpty:function(){var e=this;return!this.$el.find(".optional-link.show").length&&(0===this.collection.size()||this.collection.every(function(t){return t.get("isRoot")||t.get("deleted")||t.get("draft")||t.get("type")===e.LinkTypes.SUBLINK}))},checkLinksInMoreDropdown:function(){return this.collection.some(function(t){return!t.get("parentLinkId")&&!t.get("pinned")&&!t.get("deleted")})},toggleEmptyState:function(t){if(this.collection.everLoaded()){this.$el.toggleClass("is-empty",t),this.$el.find(".links-list").mToggle("block",!t),this.$el.find(".links-list").toggleClass("is-empty-has-pinned",""===this.$el.find(".links-list").val()&&this.hasPinned()),this.$el.find(".footer-input").mToggle("flex",!t);var e=this.getLinkDropdownText();this.$moreLinksDropdownIcon.mToggle("unset",e===this.DropdownTitles.HAS_PINNED),this.$moreLinksButton.text(e),this.$el.toggleClass("no-pinned",e===this.DropdownTitles.NO_PINNED),this.$el.closest(".top-left").toggleClass("links-empty",t)}},checkInclusion:function(t){var e=r.models.bookmarksSettings,i=d(t);i.toggleClass("show",e.get(i.attr("data-momo-id")+"Location")===i.attr("data-place"))},addPlaceholder:function(){"second"===this.currentSubview?this.$placeholder=d("<li><a>&nbsp;</a></li>").addClass("placeholder"):this.$placeholder=d('<li><div class="link-wrapper"><a>&nbsp;</a></li>').addClass("placeholder"),this.$placeholder.appendTo(this.el)},removePlaceholder:function(){this.$placeholder&&(this.$placeholder.remove(),this.$placeholder=void 0)},getLinkDropdownText:function(){return this.checkEmpty()?this.DropdownTitles.EMPTY_STATE:this.hasPinned()?this.DropdownTitles.HAS_PINNED:this.DropdownTitles.NO_PINNED},hasPinned:function(){return this.collection.some(function(t){return!t.get("parentLinkId")&&t.get("pinned")})},render:function(){var t=this.getLinkDropdownText(),e={isChrome:isChrome(),moreDropdownText:t,addGroup:s.templates["add-group"]};return this.$el.hasClass("app")&&(this.$el[0].style.width="",this.$el=this.$el.closest(".links")),this.$app=this.$el.find(".app"),this.$el.hasClass("app")?this.$app=this.$el:this.team||(this.$app=this.$el.find(".app")),this.team?(this.$el.html(this.template(e)),this.$app=this.$el.find(".app")):this.$app.html(this.template(e)),this.$baseLinks=this.$(".team-dash-links").first(),this.$appWrapper=this.$el.find(".app-wrapper"),this.$subviews=this.$(".subviews"),this.$linkUrls=this.$(".link-urls"),this.$linkUrlsWrapper=this.$(".link-urls-wrapper"),this.$app.css("height","auto"),this.$otherLinks=this.$app.find(".links-main ol"),this.renderedOnce=!0,r.models.customization.get("linksKeepOpen")&&"true"===localStorage.getItem(this.linksOpenKey)&&this.showPopup(),this.$list=this.$(".links-list"),this.$moreLinksButton=this.$(".more-links"),this.$moreLinksDropdownIcon=this.$(".more-links-wrapper .icon"),this.$app.toggleClass("no-extra",!this.checkLinksInMoreDropdown()),this.$el.toggleClass("no-pinned",t===this.DropdownTitles.NO_PINNED),this.team&&!this.loadTriggered&&(r.widgetManager.appReady(s.info.id),this.loadTriggered=!0),r.appsReady&&this.$el.find(".subviews").removeClass("no-transition"),this.initializeResizeSensor(),this},destroy:function(){this.$el.mUnbindClickOutside(),this.remove(),this.unbind()},keepOpenChanged:function(){this.hidePopup()},visibleChanged:function(){if(r.models.customization.get("linksVisible"))this.renderedOnce?(this.$el.mFadeIn(),this.$el.addClass("app-container")):this.render();else{var t=this;this.$el.mFadeOut(null,null,function(){t.$el.removeClass("app-container")})}},doFetch:function(){this.initialFetchStarted=!0,this.collection.fetch({reset:!0})},doFetchIfNeeded:function(){this.initialFetchStarted||this.doFetch()},switchTo:function(t){var e=this;switch(this.switching=this.isOpen&&this.currentSubview!==t,this.switching&&(this.$el.addClass("disable-smooth-height"),this.$subviews.css("height",Math.min(this.$subviews[0].clientHeight,this.heightLimit)),this.$el.addClass("hide-scroll")),this.$subviews.removeClass("first second").addClass(t),this.currentSubview=t){case"first":this.activeViewElement=this.$subviews.children()[0];break;case"second":this.activeViewElement=this.$subviews.children()[1]}this.switching&&(this.$subviews.css("height",Math.min(this.activeViewElement.scrollHeight,this.heightLimit)),setTimeout(function(){e.switching=!1,e.$subviews.css("height",""),e.$el.removeClass("hide-scroll disable-smooth-height")},300))},addUrl:function(t){var e=new s.views.QuickLink({model:t,parent:this,noIcon:!0,draft:!0});this.$el.find(".urls").append(e.render().$el)},handleBack:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.dashDetail?this.toggleShow():this.showMain()},showMain:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.dropdownOpen&&this.toggleDropdown(),this.switchTo("first")},clearUrl:function(){this.$el.find(".new-url").val("")},clearAdd:function(){this.$el.find(".new-title").val(""),this.$el.find(".links-add .urls").html(""),this.clearUrl()},showAddGroup:function(t){this.activeModel=null,this.$el.find(".new-group-url").addClass("active"),this.clearAdd(),this.$el.find(".links-add").removeClass("editing");var e=this;return this.switchTo("second"),setTimeout(function(){e.$el.find(".new-group-title").trigger("focus")},300),!0},showUpsell:function(t){this.upsellView&&this.upsellView.remove(),t.template=r.templates.upsell.appupsell,this.upsellView=new r.views.upsell.Message(t);var e=this.upsellView.render().$el;this.$el.find(".app").append(e),this.upsellView.show()},collectionReset:function(){this.addAll()},added:function(t){t.get("type")===this.LinkTypes.SUBLINK||t.get("draft")||t.get("isRoot")||(this.addOne(t),this.checkOptionalLinks(),this.team&&this.setAppPosition())},addOne:function(t){if(!t.get("draft")||t.get("type")!==this.LinkTypes.GROUP){var e=null;this.team&&t.get("pinned")?e=this.$baseLinks:(e=this.$otherLinks,this.team&&!this.moreIsSet&&(this.$moreLinksButton.addClass("active"),this.$moreLinksButton.css("top",30+this.$el.outerHeight(!0)-this.$moreLinksButton.outerHeight(!0)/2+"px")));var i=new s.views.QuickLink({model:t,parent:this,noIcon:e===this.$baseLinks});this.subViews.push(i),e.append(i.render().$el)}},addAll:function(){this.offline=!1,_.each(this.subViews,function(t){t&&t.destroy&&t.destroy()}),this.subViews=[];var e=this,t=this.collection.getHierarchy(),i=0;t.map(function(t){if(t.get("title")){var e=t.get("title").length;i<e&&(i=e)}});var n=i<22?"":i<29?"wide":i<35?"wider":"widest";this.$el.addClass(n),t.map(function(t){e.addOne(t)}),this.hasPinned()||this.$el.addClass("no-pinned"),this.checkOptionalLinks(),this.team&&!this.isOpen&&this.setAppPosition(),this.loadTriggered||(r.trigger(s.info.id+":loadedComplete"),this.loadTriggered=!0),this.$el.find(".loading-message").toggle(!this.collection.everLoaded()),this.$el.find(".app").first().css("height","auto")},setAppPosition:function(){var t=this,e=this.$el.find(".team-dash-links-wrapper"),i=e.outerHeight(!0)+e.offset().top-this.$appWrapper.parent().offset().top;20<i?this.$appWrapper.css({top:8+i+"px",left:0}):setTimeout(function(){t.setAppPosition()},100)},confirmCreate:function(){var t=this.$el.find(".new-group-title").val().trim();if(t&&0!==t.length){var e=this.$el.find(".new-group-url").val();if(e&&e.length)this.saveUrl();else if(!this.activeModel||0===this.activeModel.sublinks.length)return void this.pulse(".new-group-url");this.activeModel&&(this.collection.confirmCreate(this.activeModel),this.addAll(),this.showMain())}else this.pulse(".new-group-title")},confirmUpdate:function(t){var e=this.$el.find(".new-group-url").val();0===e.length&&this.activeModel.sublinks.every(function(t){return t.get("draftDeleted")})?this.pulse(".new-group-url"):(e&&e.length&&this.saveUrl(),this.activeModel.sublinks.slice(0).map(function(t){t.get("draftDeleted")?t.delete():t.get("draft")&&t.save("draft",!1)}),this.addAll(),this.showMain())},setHeightLimit:function(t){var e=d(".top-left").outerHeight(!0)+d(".bottom").outerHeight(!0),i=d(".team-dash-links-wrapper").outerHeight(!0),n=d(".bookmarks-wrapper"),s=0;n.css("transform")&&(s=parseInt(n.css("height"))-parseInt(n.css("transform").split(",")[5]||0)),this.heightLimit=document.body.getBoundingClientRect().height-(e+s+(i||0)+4),this.$subviews.css("max-height",this.heightLimit)},handleNameKeyUp:function(t){if(t&&27===t.keyCode)return t.stopPropagation(),this.escPressed=!0,void d(t.currentTarget).trigger("blur");t&&13!==t.keyCode||(this.saveTitle(t),d(t.currentTarget).trigger("blur"))},saveTitle:function(t){if(this.escPressed)this.escPressed=!1;else{var e=this.$el.find(".new-group-title").val();if((e=e&&e.trim())&&0!==e.length){t.stopPropagation(),t.preventDefault();var i=this.activeModel,n=this.$(".new-group-url"),s=n.val();i?i.save("title",e):s&&0!==s.length&&this.isPlusUser?this.saveLinkGroup(t):n.trigger("focus")}}},checkPlusShowUpsell:function(){if(this.isPlusUser)return!0;return r.commandManager.execute("upsell.message",{targetRegion:"quicklinks",sourceEvent:"tab-groups",buttonText:"Learn more",title:"Tab Groups",description:"Open multiple websites<br>with one click."}),!1},saveUrlByClick:function(t){t.stopPropagation();var e=this.$el.find(".new-group-url");this.checkPlusShowUpsell()&&(e.is(":visible")?this.saveUrl():(e.addClass("active"),e.trigger("focus")))},saveUrl:function(t){if(t&&27===t.keyCode)return t.stopPropagation(),void d(t.currentTarget).trigger("blur");if(!t||13===t.keyCode){var e=this.activeModel;if(e){var i=this.$el.find(".new-group-url"),n=i.val(),s=this;0!==n.length?(r.sendEvent("Quick Links","Add"),this.collection.create(s.createUrl(n,this.activeModel),{success:function(t){e.sublinks.push(t),e.get("linksOrder").push(t.get("id")||t.get("csid")),t.group=e,s.addUrl(t)}}),this.clearUrl(),i.focus(),this.$el.find(".urls li:visible").length&&!this.isPlusUser&&i.removeClass("active")):this.pulse(".new-group-url")}else this.saveLinkGroup(t)}},createUrl:function(t,e){var i,n=0;return e&&e.sublinks&&0<e.sublinks.length&&(i=e.sublinks[e.sublinks.length-1]),i&&(n=i.get("order")+10),{title:null,url:ensureUrlScheme(t),local:/^chrome|chrome-extension|chrome-search:\/\//i.test(t),csid:uuidv4(),parentLinkId:e?e.get("id")||e.get("csid"):null,unsyncable:!!e&&!e.get("id"),position:e&&e.sublinks?e.sublinks.length-1:0,type:e?this.LinkTypes.SUBLINK:this.LinkTypes.GROUP,order:n,draft:!0}},saveLinkGroup:function(i){i&&i.preventDefault&&(i.stopImmediatePropagation(),i.preventDefault()),this.activeModel=null;var n=this.$el.find(".new-group-url"),t=this.$el.find(".new-group-title").val();t=t&&t.trim();var s=n.val(),l=this;if(0!==s.length){r.sendEvent("Quick Links","Add");var e=0;if(0<this.collection.length)e=this.collection.max(function(t){return t.get("order")}).get("order")+100;this.collection.create({title:t,linksOrder:[],order:e,type:this.LinkTypes.GROUP,draft:!0},{success:function(e){e&&(l.activeModel=e,l.collection.create(l.createUrl(s,e),{success:function(t){e.sublinks=[t],e.group=e,l.addUrl(t),e.get("linksOrder").push(t.get("id")||t.get("csid")),l.clearUrl(),1===e.getActiveSublinks().length&&i&&"keyup"===i.type?n.removeClass("active"):n.focus()}}))}})}else this.pulse(".new-group-url")},pulse:function(t){var e=this;this.$el.find(t).trigger("focus"),this.$el.find(t).addClass("pulse"),_.delay(function(){e.$el.find(t).removeClass("pulse")},1e3)},showDetail:function(t,e){if(e)if(this.isOpen)d.contains(this.$el.find(".links-app")[0],e.target)||this.toggleShow();else{d(e.currentTarget).closest("li").addClass("active");var i=this.$el.find(".subviews");i.addClass("no-transition"),setTimeout(function(){i.removeClass("no-transition")},10),this.showPopup(!0)}this.activeModel=t;var n=this;this.clearAdd();var s=this.$el.find(".links-add .new-group-title");s.val(t.get("title")),t.getActiveSublinks().map(function(t){n.addUrl(t)}),this.$el.find(".links-add").addClass("editing"),this.$el.find(".new-group-url").removeClass("active"),this.switchTo("second"),setTimeout(function(){s.trigger("focus")},300)},handleDragStart:function(t){this.dragmode="quicklink",this.dragging=t,this.updateFirstLink()},dragover:function(t){return t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="move",this.updateFirstLink(),!1},drop:function(t){t.preventDefault(),t.stopPropagation(),this.checkOptionalLinks()},dragend:function(t){if(t.originalEvent.dataTransfer.dropEffect="move",t.preventDefault(),t.stopPropagation(),"quicklink"===this.dragmode){var e=this.dragging.model,i=t.target.closest("ol").classList.contains("more-links-list")&&e.get("pinned"),n=t.target.closest("ol").classList.contains("team-dash-links")&&!e.get("pinned");(n||i)&&e.save("pinned",n),this.dragging.$el.css("display","list-item"),this.removePlaceholder();var s=e.collection.serverIdAttribute,l=e.collection.idAttribute,a=this.collection.offlineOnly?l:s;this.collection.trigger("reorder",{moveId:e.get(a)||e.get(l),moveTargetId:this.moveTargetId,moveOffset:this.moveOffset,inEdit:0<d(t.target).closest(".links-add").length})}return this.checkOptionalLinks(),!1},toggleHandler:function(t){return this.toggleShow(t,!0)},toggleShow:function(t,e){return this.isOpen?this.hidePopup(t,e):this.showPopup(),this.doFetchIfNeeded(),this.isOpen},showPopup:function(t){if(this.setHeightLimit(),this.dashDetail=!!t,this.isOpen=!0,localStorage.setItem(this.linksOpenKey,"true"),this.$el.addClass("show").outerWidth(),this.$el.addClass("show-fade-in"),!t){this.team&&this.setAppPosition();var e=this.$el.find(".subviews");e.addClass("no-transition"),setTimeout(function(){e.removeClass("no-transition")},10),this.showMain()}},forceHidePopup:function(t){this.dashDetail=!1;var e=this;this.isOpen=!1,t||this.$el.find(".team-dash-links > li").removeClass("active"),localStorage.setItem(this.linksOpenKey,"false"),this.$el.removeClass("show-fade-in").bind("transitionend webkitTransitionEnd",function(){d(this).unbind("transitionend webkitTransitionEnd"),e.$el.hasClass("show-fade-in")||e.$el.removeClass("show")})},hidePopup:function(t,e){if(!(t===this||t&&t.target&&d.contains(this.$el[0],t.target)&&!e)){this.$el.removeClass("active");var i=this;if(this.upsellView&&this.upsellView.showing)return this.upsellView.hideUpsell(t),t.stopPropagation(),void t.preventDefault();setTimeout(function(){i.showMain()},50),!this.isOpen||r.models.customization.get("linksKeepOpen")&&!e||this.forceHidePopup()}},preventCloseOnEsc:function(){return r.models.customization.get("linksKeepOpen")},handleClick:function(t){t.stopPropagation(),t.preventDefault();var e=t.currentTarget.href;r.models.bookmarksSettings.get("openInNewTab")||t.metaKey?getBrowser().tabs.create({url:e,active:!1}):getBrowser().tabs.update({url:e})},li_index:function(t){return this.$("li").index(t)},appsLoaded:function(){this.handleResize();var t=this.$el.find(".subviews");setTimeout(function(){t.removeClass("no-transition")},10)},handleResize:function(){this.isOpen&&this.setHeightLimit()}}),s.styles.style(),s.LinkTypes={LINK:0,GROUP:1,SUBLINK:2},s};m.addinManager&&m.addinManager.registerAddinFn("417829ca-7ff0-4089-b265-f775180c843e",fn_addin);